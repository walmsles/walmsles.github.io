<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Serverless Integration, Zero Code" /><meta name="author" content="Michael Walmsley" /><meta property="og:locale" content="en_US" /><meta name="description" content="The words of Farah Campbell and Ben Kehoe on “The Serverless Mindset” has inspired me to level up my thinking and approach to Serverless integration. So let me share my journey to zero code integration with you." /><meta property="og:description" content="The words of Farah Campbell and Ben Kehoe on “The Serverless Mindset” has inspired me to level up my thinking and approach to Serverless integration. So let me share my journey to zero code integration with you." /><link rel="canonical" href="https://www.walmsles.io/posts/serverless-integration-zero-code/" /><meta property="og:url" content="https://www.walmsles.io/posts/serverless-integration-zero-code/" /><meta property="og:site_name" content="@walmsles" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-09T00:00:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Serverless Integration, Zero Code" /><meta name="twitter:site" content="@walmsles" /><meta name="twitter:creator" content="@Michael Walmsley" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Michael Walmsley"},"headline":"Serverless Integration, Zero Code","dateModified":"2021-10-12T23:48:38+11:00","datePublished":"2021-10-09T00:00:00+11:00","url":"https://www.walmsles.io/posts/serverless-integration-zero-code/","description":"The words of Farah Campbell and Ben Kehoe on “The Serverless Mindset” has inspired me to level up my thinking and approach to Serverless integration. So let me share my journey to zero code integration with you.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.walmsles.io/posts/serverless-integration-zero-code/"},"@context":"https://schema.org"}</script><title>Serverless Integration, Zero Code | @walmsles</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-XSEE8H98BV"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XSEE8H98BV'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">@walmsles</a></div><div class="site-subtitle font-italic">Relocating this blog to Hashnode at new URL - http://blog.walmsles.io</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/walmsles" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/walmsles" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['michael','walmsles.io'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Serverless Integration, Zero Code</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Serverless Integration, Zero Code</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Oct 9, 2021, 12:00 AM +1100" > Oct 9, 2021 <i class="unloaded">2021-10-09T00:00:00+11:00</i> </span> by <span class="author"> Michael Walmsley </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 12, 2021, 11:48 PM +1100" > Oct 12, 2021 <i class="unloaded">2021-10-12T23:48:38+11:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1813 words">10 min</span></div></div><div class="post-content"><blockquote><p>The words of Farah Campbell and Ben Kehoe on “The Serverless Mindset” has inspired me to level up my thinking and approach to Serverless integration.</p><p>So let me share my journey to zero code integration with you.</p></blockquote><p>For my first foray into zero code integration, I decided to keep things simple and play with the classic integration pattern of sending data via an API into an SQS queue for downstream processing. Most serverless websites will have you build an architecture like this, an API gateway triggering a Lambda that pushes to the SQS queue for downstream processing.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/upguplizspa6ubpucpxi.jpg" alt="Simple Classic Lambda Integration Architecture (with code)" /></p><p>This pattern is easy to build, deploy and get working with any of the main Serverless frameworks; my weapon of choice is the Serverless Framework from Serverless Inc. The Serverless Framework focuses on deploying Lambda functions and makes this task quick and easy. For example, to build the Lambda processor pushing to SQS looks something like this.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="na">service</span><span class="pi">:</span> <span class="s">api-lambda-sqs</span>

<span class="na">frameworkVersion</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>

<span class="na">provider</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">aws</span>
  <span class="na">runtime</span><span class="pi">:</span> <span class="s">python3.8</span>
  <span class="na">lambdaHashingVersion</span><span class="pi">:</span> <span class="m">20201221</span>

<span class="na">functions</span><span class="pi">:</span>
  <span class="na">apiPushSQS</span><span class="pi">:</span>
    <span class="na">handler</span><span class="pi">:</span> <span class="s">handler.api_push_sqs</span>
    <span class="na">events</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">THE_QUEUE</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">downstreamSQS</span>

<span class="na">resources</span><span class="pi">:</span>
  <span class="na">Resources</span><span class="pi">:</span>

    <span class="na">downstreamSQS</span><span class="pi">:</span>
      <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::SQS::Queue</span>
</pre></table></code></div></div><p>Building out the pattern is simple, and the framework focuses on Lambda functions and their events which makes building and deploying quick and easy. I managed to do this in minutes and felt productive; the instant win had my endorphins flowing, and I was conquering it!</p><p><strong>But is this the ideal serverless solution?</strong></p><p>I am sure Ben Kehoe would say, “If you came along to my talk today to hear about Lambda, you are in the wrong place”, and these words are echoing in my head right now as I write this and think how I can do this without code.</p><p>We all know the AWS API Gateway supports direct, native integrations with many services, and I have designed many systems around these patterns. Still, I have never actually built one using the Serverless framework; until now.</p><p>To achieve direct integrations from API gateway to other Services involves understanding how to configure the Integration request, and there are choices as to how we can go about this. I started by configuring the API via the console and followed one of the few blog articles I could find on this topic to set it up, which you can look at <a href="https://medium.com/@pranaysankpal/aws-api-gateway-proxy-for-sqs-simple-queue-service-5b08fe18ce50">here</a>.</p><p>This article allowed me to see the steps I needed to complete:</p><ol><li>Create the SQS Queue<li>Create the IAM Policy allowing API Gateway to use the sqs:SendMessage action on my SQS Queue.<li>Create the role to attach the policy to and enable API gateway to assume the role.<li>Create the API and define a POST method that we can use to map the incoming request through to the SQS queue.<li>Integrate the API resource with our SQS Queue and create an integration mapping template to transform the incoming payload for our forwarding request to the SQS service.<li>Deploy and Test the API</ol><p>Continue with me on my journey to complete these steps and end up with the following architecture, which uses zero-code.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jbdv7d8fs489cyb533us.jpg" alt="Zero-Code Serverless.yml" /></p><p>To achieve a zero-code solution, we need to learn about the native AWS language of Velocity Templates and understand how data flows through the API Gateway service. As Ben and Farrah would say - writing code is easy, but being genuinely serverless takes work, and it’s not always the work we want to do or is fun to do, but we need to challenge ourselves to leverage the cloud services and write less code!</p><h2 id="how-the-api-gateway-data-flow-works">How the API Gateway Data flow works</h2><p>A quick high-level look at an API gateway request for a v1 REST API looks like this.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/401fkrejoihzh0dibyvv.png" alt="AWS API Gateway Data Flow" /></p><p>Each client request goes through the following stages for a simple un-authenticated request:</p><ol><li>Method Request<li>Integration Request - where transformations occur for the integration request to SQS<li>Backend Service (Simple Queue Service in this case)<li>Integration Response - where transformations occur for the integration response from SQS<li>Method Response - Mapping of integration Response to Method response for the client.</ol><p>Now that we know the steps for the API request through the gateway, we can start setting this up using the Serverless framework because that’s my current go-to for deploying serverless solutions.</p><h2 id="create-the-sqs-queue">Create the SQS Queue</h2><p>Creating the SQS queue is the easiest part of this solution. First, add the following to the resources section of the serverless YAML file. I prefer not to provide the QueueName when setting up SQS; this allows the serverless framework to name the resources using the usual naming standard of serviceName-stage-resourceName-randomString.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="na">sqsQueue</span><span class="pi">:</span>
      <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::SQS::Queue</span>
</pre></table></code></div></div><h2 id="create-the-iam-policy-and-role">Create the IAM Policy and Role</h2><p>To create the IAM Role and Policy, we cannot use the standard IAM methods for the Serverless Framework since these focus on setting up IAM Roles and Policies for functions in your solution. This time there are no functions or Lambdas at all! Add the role and policy details into the Serverless YAML file in the resources section.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zc45qsy3wgn8pm7qweqh.png" alt="IAM Role and Policy" /></p><p><strong>Lines 23 - 34</strong> enable API gateway to assume the role</p><p><strong>Lines 35 - 44</strong> define the actions allowed by the policy</p><p><strong>Line 44</strong> uses Cloudformation intrinsic function !GetAtt to get the Arn of the SQS Queue we create in the stack.</p><h2 id="create-the-rest-api">Create the Rest API</h2><p>To create the Rest API, we need to create an AWS::Apigateway::Rest resource. Usually, the Serverless Framework would make this for you under the covers as it creates functions triggered by HTTP events. In the configuration for the RestApi, I have used <code class="language-plaintext highlighter-rouge">${self:custom.resourcePrefix}</code> for the “Name”, which is a variable I set up to use for the naming of Services throughout my Serverless YAML.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6pcsliy8zt4bmbo8229v.png" alt="Create AWS RestApi" /></p><h2 id="create-the-api-resources-and-integrate-to-our-sqs">Create the API Resources and Integrate to our SQS</h2><p>We create the API method using the “AWS::ApiGateway::Method” resource, which needs to look like this.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mmoe5x1iwlng85mvowst.png" alt="AWS API Method" /></p><p>Creating the API method and integration is where all the work is in building out our zero-code solution and will break this down into the following steps for clarity:</p><ol><li>Create the API Method and Responses (lines 60 - 70)<li>Create the integration - the easy bits (lines 71 - 79)<li>Create the Integration Request (lines 80 - 84)<li>Create the Integration Response (lines 85 - 99)</ol><h3 id="create-the-api-method">Create the API Method</h3><p>Creating the Method resource is the easy bit. We set up the API Method on line 60 and Method responses on lines 64 - 69. The HTTP status codes returned by the Integration response must be configured in the Method responses so that the API gateway will not throw an error and return an “HTTP 500 internal server error”.</p><p>On <strong>line 61</strong>, we use “!GetAtt apiGw.RootResourceId” to obtain the actual Id for the RestApi.</p><p>On <strong>line 62</strong>, we use “!Ref apiGw” to retrieve the RestApiId for our REST API.</p><p>We have to use these Cloudformation intrinsic functions here since we want the values after AWS has created them during the stack deployment.</p><h3 id="create-the-integration---the-easy-bits">Create the integration - the easy bits</h3><p>I will break this down by the lines to make it easier to follow and explain each step.</p><p><strong>Line 71</strong> defines the HTTP Method API gateway will use when calling the Integration endpoint; in this case, we want to use POST since we are sending data to SQS.</p><p><strong>Line 72</strong> defines the type of integration; in this case, we are doing a direct service integration, so will use “AWS”. Using AWS means using an internal integration that allows us to transform the payload rather than “AWS_PROXY”, which will proxy the request directly to the integration service leaving the body untouched.</p><p><strong>Line 73</strong> defines the IAM Role the API Gateway will assume while performing the integration.</p><p><strong>Line 74</strong> defines the URI of the action we want to invoke. The Uri action we need to invoke will look like “arn:aws:API gateway:us-east-1:sqs:path/1234567890/the_queue_name”, so we are using the Cloudformation intrinsic function “Join” to create this for us.</p><p>Once we have these attributes configured, we have defined the core details on the service we are integrating, the “How”.</p><h3 id="create-the-integration-request">Create The Integration Request</h3><p><strong>Line 80</strong> defines the PassthroughBehaviour - I like to use “NEVER” so that if we receive an unexpected request “Content-Type”, then API gateway will respond with an <code class="language-plaintext highlighter-rouge">HTTP 415 error - Unsupported Media Type</code>, which I think is desirable.</p><p><strong>Line 81 - 82</strong> defines the request parameters we send to SQS; we will map our request into <code class="language-plaintext highlighter-rouge">x-www-form-urlencoded</code> values when sending our POST to SQS.</p><p><strong>Lines 83 - 84</strong> define how we will transform the incoming body and send it to SQS; this is a simple VTL template setting the <code class="language-plaintext highlighter-rouge">Action=SendMessage</code> and <code class="language-plaintext highlighter-rouge">MessageBody=$input.JSON($)</code>, which is the JSON body of the request to be sent to the SQS queue.</p><h3 id="create-the-integration-response">Create the Integration Response</h3><p>So far, we have created the API, formed the integration request and sent it to SQS; now, we have to deal with the SQS service response and map a response back to our caller using the “IntegrationResponses” attribute. The value expected here is a MAP of HTTP status codes and VTL template snippets to transform the HTTP response we get from SQS. In this demo, I have mapped the following response codes - 200, 404 to responses that will look something like the following:</p><p><strong>HTTP 200 Response</strong></p><p>We use a VTL template to transform the SQS response into a payload that we want to return rather than the entire integration payload.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span>  
	<span class="dl">"</span><span class="s2">request_id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ea87ccb1-92d3-51ff-b9f0-956ad19844d7</span><span class="dl">"</span><span class="p">,</span>  
	<span class="dl">"</span><span class="s2">message_id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">173689a1-6b40-492e-9e6c-338c13b70f16</span><span class="dl">"</span><span class="p">,</span> 
	<span class="dl">"</span><span class="s2">accepted</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span> 
<span class="p">}</span>
</pre></table></code></div></div><p><strong>HTTP 404 Response</strong></p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="p">{</span>
	<span class="dl">"</span><span class="s2">error_code</span><span class="dl">"</span><span class="p">:</span> <span class="mi">404</span><span class="p">,</span>
	<span class="dl">"</span><span class="s2">error_message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Unable to complete Request</span><span class="dl">"</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="deploy-and-test-the-api">Deploy and Test the API</h2><p>After creating the SQS Queue and a new REST API, we need to deploy our API to a stage so our clients can call the API. Lines 101 - 108 define the Stage Deployment of our API and will make the API available. Important Note: This resource will only work for the first deployment; any change to your REST API will not deploy as part of a stack update. I searched far and wide for a solution to this behaviour and landed on the need to run a post-stack update API deployment using the console or AWS CLI.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">$</span> <span class="nx">aws</span> <span class="nx">apigateway</span> <span class="nx">create</span><span class="o">-</span><span class="nx">deployment</span> <span class="o">--</span><span class="nx">region</span> <span class="o">&lt;</span><span class="nx">region</span><span class="o">&gt;</span> <span class="o">\</span>
    <span class="o">--</span><span class="nx">rest</span><span class="o">-</span><span class="nx">api</span><span class="o">-</span><span class="nx">id</span> <span class="o">&lt;</span><span class="nx">api</span><span class="o">-</span><span class="nx">id</span><span class="o">&gt;</span> <span class="o">\</span>
    <span class="o">--</span><span class="nx">stage</span><span class="o">-</span><span class="nx">name</span> <span class="o">&lt;</span><span class="nx">stage</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
</pre></table></code></div></div><h2 id="the-wrap-up">The Wrap-Up</h2><p>Writing a Zero-Code Serverless integration has been an evolving journey, and I have shared the details of where I ended up in this article. I have learned a lot about AWS along the way and encourage you to explore and try code-less integrations in your solutions as a way of levelling up your journey to serverless nirvana. What I have shared today is not production-ready - I am still exploring these patterns to make them more resilient and reliable for live use.</p><p>Check out the real working Serverless Solution (No code included) on my GitHub repository [here](</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/serverless/'>serverless</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/serverless/" class="post-tag no-text-decoration" >serverless</a> <a href="/tags/zerocode/" class="post-tag no-text-decoration" >zerocode</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="">Copyright Michael Walmsley © 2020</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Serverless Integration, Zero Code - @walmsles&url=https://www.walmsles.io/posts/serverless-integration-zero-code/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Serverless Integration, Zero Code - @walmsles&u=https://www.walmsles.io/posts/serverless-integration-zero-code/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.walmsles.io/posts/serverless-integration-zero-code/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Relocating-Blog/">Relocating Blog</a><li><a href="/posts/correlating-transactions-zero-code/">Correlating Transactions with Zero Code</a><li><a href="/posts/serverless-integration-zero-code/">Serverless Integration, Zero Code</a><li><a href="/posts/getting-started-with-serverless/">Getting Started with Serverless</a><li><a href="/posts/securing-aws-cli/">Using the AWS CLI Securely</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/serverless/">serverless</a> <a class="post-tag" href="/tags/lambda/">lambda</a> <a class="post-tag" href="/tags/zerocode/">zerocode</a> <a class="post-tag" href="/tags/aws-lambda-powertools/">aws lambda powertools</a> <a class="post-tag" href="/tags/aws-cli/">aws-cli</a> <a class="post-tag" href="/tags/security/">security</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/correlating-transactions-zero-code/"><div class="card-body"> <span class="timeago small" > Oct 12, 2021 <i class="unloaded">2021-10-12T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Correlating Transactions with Zero Code</h3><div class="text-muted small"><p> I take pride in writing detailed, technical articles filled with solid code examples and links to Github so you can review and learn from my serverless journey. Today, I think this will be my sh...</p></div></div></a></div><div class="card"> <a href="/posts/getting-started-with-serverless/"><div class="card-body"> <span class="timeago small" > Jun 20, 2021 <i class="unloaded">2021-06-20T00:00:00+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting Started with Serverless</h3><div class="text-muted small"><p> I started learning about serverless development and AWS lambda in 2016 while working with startup companies building web APIs and single-page apps. These companies were Digital Agencies building ou...</p></div></div></a></div><div class="card"> <a href="/posts/making-your-apis-idempotent/"><div class="card-body"> <span class="timeago small" > Aug 22, 2021 <i class="unloaded">2021-08-22T00:00:00+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Making All Your APIs Idempotent</h3><div class="text-muted small"><p> When you start working with Serverless on AWS, one of the first questions you should be asking yourself is — “is my system Idempotent”? What is Idempotency? Idempotency is a straightforward b...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/making-your-apis-idempotent/" class="btn btn-outline-primary" prompt="Older"><p>Making All Your APIs Idempotent</p></a> <a href="/posts/correlating-transactions-zero-code/" class="btn btn-outline-primary" prompt="Newer"><p>Correlating Transactions with Zero Code</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/walmsles">Michael Walmsley</a>. <span data-toggle="tooltip" data-placement="top" title="">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/serverless/">serverless</a> <a class="post-tag" href="/tags/lambda/">lambda</a> <a class="post-tag" href="/tags/zerocode/">zerocode</a> <a class="post-tag" href="/tags/aws-lambda-powertools/">aws lambda powertools</a> <a class="post-tag" href="/tags/aws-cli/">aws cli</a> <a class="post-tag" href="/tags/security/">security</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.walmsles.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
